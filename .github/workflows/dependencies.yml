name: Dependency Updates

# å·¥ä½œæµå·²ç¦ç”¨
on:
  # ç¦ç”¨æ‰€æœ‰è‡ªåŠ¨è§¦å‘å™¨
  # schedule:
  #   # æ¯å‘¨ä¸€æ—©ä¸Š8ç‚¹æ£€æŸ¥ä¾èµ–æ›´æ–°
  #   - cron: '0 8 * * 1'
  #   # æ¯æœˆ1å·è¿è¡Œä¸»ç‰ˆæœ¬æ›´æ–°æ£€æŸ¥
  #   - cron: '0 8 1 * *'
  workflow_dispatch:
    inputs:
      update_type:
        description: 'Type of update to perform'
        required: false
        default: 'minor'
        type: choice
        options:
        - patch
        - minor  
        - major
        - all
      dry_run:
        description: 'Dry run mode (no changes made)'
        required: false
        type: boolean
        default: false
      force_update:
        description: 'Force update even if tests fail'
        required: false
        type: boolean
        default: false

# å¹¶å‘æŽ§åˆ¶ï¼šç¡®ä¿åªæœ‰ä¸€ä¸ªä¾èµ–æ›´æ–°å·¥ä½œæµåœ¨è¿è¡Œ
concurrency:
  group: dependencies-${{ github.ref }}
  cancel-in-progress: false  # ä¸å–æ¶ˆè¿›è¡Œä¸­çš„ä¾èµ–æ›´æ–°ï¼Œé¿å…çŠ¶æ€ä¸ä¸€è‡´

permissions:
  contents: write
  pull-requests: write
  checks: write
  actions: read
  issues: write

env:
  NODE_VERSION: '18'
  UPDATE_TYPE: ${{ github.event.inputs.update_type || (github.event.schedule == '0 8 1 * *' && 'major' || 'minor') }}
  DRY_RUN: ${{ github.event.inputs.dry_run || 'false' }}
  FORCE_UPDATE: ${{ github.event.inputs.force_update || 'false' }}

jobs:
  analyze-dependencies:
    name: ï¿½ Analyze Dependencies
    runs-on: ubuntu-latest
    outputs:
      has_updates: ${{ steps.check_updates.outputs.has_updates }}
      update_summary: ${{ steps.check_updates.outputs.update_summary }}
      security_updates: ${{ steps.check_updates.outputs.security_updates }}
      major_updates: ${{ steps.check_updates.outputs.major_updates }}
      
    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0
        
    - name: ðŸ“¦ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: ${{ env.NODE_VERSION }}
        cache: 'npm'
        
    - name: ï¿½ Install dependencies
      run: npm ci
        
    - name: ï¿½ðŸ” Check for updates
      id: check_updates
      run: |
        echo "## ðŸ” Dependency Analysis Report" >> $GITHUB_STEP_SUMMARY
        echo "**Update Type**: ${{ env.UPDATE_TYPE }}" >> $GITHUB_STEP_SUMMARY
        echo "**Dry Run Mode**: ${{ env.DRY_RUN }}" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        # èŽ·å–è¿‡æœŸçš„ä¾èµ–
        npm outdated --json > outdated.json || true
        
        if [ -s outdated.json ] && [ "$(cat outdated.json)" != "{}" ]; then
          echo "has_updates=true" >> $GITHUB_OUTPUT
          
          # åˆ†æžæ›´æ–°ç±»åž‹
          PATCH_UPDATES=$(cat outdated.json | jq -r 'to_entries[] | select(.value.wanted != .value.latest and (.value.wanted | split(".")[0]) == (.value.current | split(".")[0]) and (.value.wanted | split(".")[1]) == (.value.current | split(".")[1])) | .key' | wc -l)
          MINOR_UPDATES=$(cat outdated.json | jq -r 'to_entries[] | select(.value.wanted != .value.latest and (.value.wanted | split(".")[0]) == (.value.current | split(".")[0]) and (.value.wanted | split(".")[1]) != (.value.current | split(".")[1])) | .key' | wc -l)
          MAJOR_UPDATES=$(cat outdated.json | jq -r 'to_entries[] | select(.value.wanted != .value.latest and (.value.wanted | split(".")[0]) != (.value.current | split(".")[0])) | .key' | wc -l)
          
          echo "### ðŸ“Š Update Summary:" >> $GITHUB_STEP_SUMMARY
          echo "- **Patch Updates**: $PATCH_UPDATES" >> $GITHUB_STEP_SUMMARY
          echo "- **Minor Updates**: $MINOR_UPDATES" >> $GITHUB_STEP_SUMMARY
          echo "- **Major Updates**: $MAJOR_UPDATES" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # è¯¦ç»†åˆ—è¡¨
          echo "### ðŸ“¦ Available Updates:" >> $GITHUB_STEP_SUMMARY
          echo "| Package | Current | Wanted | Latest | Type |" >> $GITHUB_STEP_SUMMARY
          echo "|---------|---------|--------|--------|------|" >> $GITHUB_STEP_SUMMARY
          
          cat outdated.json | jq -r 'to_entries[] | "| \(.key) | \(.value.current) | \(.value.wanted) | \(.value.latest) | \(if (.value.wanted | split(".")[0]) != (.value.current | split(".")[0]) then "major" elif (.value.wanted | split(".")[1]) != (.value.current | split(".")[1]) then "minor" else "patch" end) |"' >> $GITHUB_STEP_SUMMARY
          
          # è¾“å‡ºæ‘˜è¦ä¿¡æ¯ä¾›åŽç»­ä½œä¸šä½¿ç”¨
          echo "update_summary=Found $PATCH_UPDATES patch, $MINOR_UPDATES minor, $MAJOR_UPDATES major updates" >> $GITHUB_OUTPUT
          echo "major_updates=$MAJOR_UPDATES" >> $GITHUB_OUTPUT
          
          # æ£€æŸ¥å®‰å…¨æ›´æ–°
          npm audit --json > audit.json 2>/dev/null || true
          if [ -s audit.json ]; then
            SECURITY_UPDATES=$(cat audit.json | jq '.metadata.vulnerabilities.total // 0')
            echo "security_updates=$SECURITY_UPDATES" >> $GITHUB_OUTPUT
            if [ "$SECURITY_UPDATES" -gt 0 ]; then
              echo "### âš ï¸ Security Updates Available: $SECURITY_UPDATES" >> $GITHUB_STEP_SUMMARY
            fi
          else
            echo "security_updates=0" >> $GITHUB_OUTPUT
          fi
          
        else
          echo "has_updates=false" >> $GITHUB_OUTPUT
          echo "update_summary=No updates available" >> $GITHUB_OUTPUT
          echo "security_updates=0" >> $GITHUB_OUTPUT
          echo "major_updates=0" >> $GITHUB_OUTPUT
          echo "### âœ… All dependencies are up to date" >> $GITHUB_STEP_SUMMARY
        fi
        
    - name: ðŸ“¤ Upload analysis results
      if: steps.check_updates.outputs.has_updates == 'true'
      uses: actions/upload-artifact@v4
      with:
        name: dependency-analysis
        path: |
          outdated.json
          audit.json
          package-lock.json
        retention-days: 7

  update-dependencies:
    name: ðŸ”„ Update Dependencies
    runs-on: ubuntu-latest
    needs: analyze-dependencies
    if: needs.analyze-dependencies.outputs.has_updates == 'true' && env.DRY_RUN != 'true'
    
    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0
        
    - name: ï¿½ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: ${{ env.NODE_VERSION }}
        cache: 'npm'
        
    - name: ðŸ“¥ Download analysis results
      uses: actions/download-artifact@v4
      with:
        name: dependency-analysis
        
    - name: ðŸ”„ Perform updates
      run: |
        echo "## ðŸ”„ Performing Dependency Updates" >> $GITHUB_STEP_SUMMARY
        echo "**Update type**: ${{ env.UPDATE_TYPE }}" >> $GITHUB_STEP_SUMMARY
        
        # å¤‡ä»½å½“å‰çŠ¶æ€
        cp package.json package.json.backup
        cp package-lock.json package-lock.json.backup
        
        # æ ¹æ®æ›´æ–°ç±»åž‹æ‰§è¡Œä¸åŒçš„æ›´æ–°ç­–ç•¥
        case "${{ env.UPDATE_TYPE }}" in
          "patch")
            echo "Updating patch versions only..."
            npm update --save --save-exact
            ;;
          "minor")
            echo "Updating minor versions..."
            npm update
            ;;
          "major")
            echo "Checking for major version updates..."
            # ä½¿ç”¨ npm-check-updates è¿›è¡Œä¸»ç‰ˆæœ¬æ›´æ–° (å¦‚æžœå¯ç”¨)
            if command -v ncu &> /dev/null; then
              ncu -u --target minor
            else
              npx npm-check-updates -u --target minor
            fi
            npm install
            ;;
          "all")
            echo "Updating all dependencies to latest..."
            if command -v ncu &> /dev/null; then
              ncu -u
            else
              npx npm-check-updates -u
            fi
            npm install
            ;;
        esac
        
        # æ£€æŸ¥æ˜¯å¦æœ‰å®žé™…å˜åŒ–
        if git diff --quiet package-lock.json package.json; then
          echo "NO_CHANGES=true" >> $GITHUB_ENV
          echo "### â„¹ï¸ No changes after update process" >> $GITHUB_STEP_SUMMARY
        else
          echo "NO_CHANGES=false" >> $GITHUB_ENV
          echo "### âœ… Dependencies updated successfully" >> $GITHUB_STEP_SUMMARY
          
          # æ˜¾ç¤ºå˜æ›´æ‘˜è¦
          echo "#### ðŸ“Š Changes:" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          git diff --stat package.json package-lock.json >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
        fi
        
    - name: ðŸ§ª Comprehensive testing
      if: env.NO_CHANGES == 'false'
      run: |
        echo "## ðŸ§ª Testing Updated Dependencies" >> $GITHUB_STEP_SUMMARY
        
        # é‡æ–°å®‰è£…ä»¥ç¡®ä¿lockfileä¸€è‡´æ€§
        npm ci
        
        # ç±»åž‹æ£€æŸ¥
        echo "### ðŸ” Type Checking" >> $GITHUB_STEP_SUMMARY
        if npm run type-check 2>&1 | tee type-check.log; then
          echo "âœ… Type checking passed" >> $GITHUB_STEP_SUMMARY
        else
          echo "âŒ Type checking failed" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          tail -20 type-check.log >> $GITHUB_STEP_SUMMARY || true
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          echo "TYPE_CHECK_FAILED=true" >> $GITHUB_ENV
        fi
        
        # æž„å»ºæµ‹è¯•
        echo "### ðŸ—ï¸ Build Testing" >> $GITHUB_STEP_SUMMARY
        if npm run build 2>&1 | tee build.log; then
          echo "âœ… Build successful" >> $GITHUB_STEP_SUMMARY
          
          # è®¡ç®—æž„å»ºå¤§å°å˜åŒ–
          if [ -f package-lock.json.backup ]; then
            echo "#### ðŸ“Š Build Size Analysis:" >> $GITHUB_STEP_SUMMARY
            OLD_SIZE=$(du -sh dist/ 2>/dev/null | cut -f1 || echo "unknown")
            echo "Build size: $OLD_SIZE" >> $GITHUB_STEP_SUMMARY
          fi
        else
          echo "âŒ Build failed" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          tail -20 build.log >> $GITHUB_STEP_SUMMARY || true
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          echo "BUILD_FAILED=true" >> $GITHUB_ENV
        fi
        
        # è¿è¡Œæµ‹è¯•å¥—ä»¶ï¼ˆå¦‚æžœå­˜åœ¨ï¼‰
        echo "### ðŸ§ª Unit Testing" >> $GITHUB_STEP_SUMMARY
        if npm run test 2>&1 | tee test.log; then
          echo "âœ… All tests passed" >> $GITHUB_STEP_SUMMARY
        else
          echo "âš ï¸ Some tests failed or test suite unavailable" >> $GITHUB_STEP_SUMMARY
          if [ -s test.log ]; then
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
            tail -20 test.log >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          fi
          echo "TEST_FAILED=true" >> $GITHUB_ENV
        fi
        
        # å®‰å…¨å®¡è®¡
        echo "### ðŸ”’ Security Audit" >> $GITHUB_STEP_SUMMARY
        if npm audit --audit-level=high --json > audit-post.json 2>/dev/null; then
          HIGH_VULNS=$(cat audit-post.json | jq '.metadata.vulnerabilities.high // 0')
          CRITICAL_VULNS=$(cat audit-post.json | jq '.metadata.vulnerabilities.critical // 0')
          
          if [ "$HIGH_VULNS" -eq 0 ] && [ "$CRITICAL_VULNS" -eq 0 ]; then
            echo "âœ… No high/critical vulnerabilities" >> $GITHUB_STEP_SUMMARY
          else
            echo "âš ï¸ Found $HIGH_VULNS high and $CRITICAL_VULNS critical vulnerabilities" >> $GITHUB_STEP_SUMMARY
            echo "SECURITY_AUDIT_FAILED=true" >> $GITHUB_ENV
          fi
        else
          echo "âœ… Security audit completed" >> $GITHUB_STEP_SUMMARY
        fi
        
        # æ•´ä½“æµ‹è¯•ç»“æžœ
        if [ "$TYPE_CHECK_FAILED" != "true" ] && [ "$BUILD_FAILED" != "true" ]; then
          echo "VALIDATION_PASSED=true" >> $GITHUB_ENV
          echo "### âœ… All validation checks passed!" >> $GITHUB_STEP_SUMMARY
        else
          echo "VALIDATION_PASSED=false" >> $GITHUB_ENV
          echo "### âŒ Some validation checks failed" >> $GITHUB_STEP_SUMMARY
        fi
        
    - name: ðŸ“‹ Generate change summary
      if: env.NO_CHANGES == 'false'
      run: |
        echo "## ðŸ“‹ Detailed Change Summary" >> change-summary.md
        echo "" >> change-summary.md
        echo "### ðŸ“Š Package Changes:" >> change-summary.md
        
        # æ¯”è¾ƒæ–°æ—§ package.json æ–‡ä»¶
        if [ -f package.json.backup ]; then
          echo "\`\`\`diff" >> change-summary.md
          diff package.json.backup package.json || true >> change-summary.md
          echo "\`\`\`" >> change-summary.md
        fi
        
        echo "" >> change-summary.md
        echo "### ðŸ”„ Updated Dependencies:" >> change-summary.md
        
        # æ˜¾ç¤ºå…·ä½“çš„ç‰ˆæœ¬å˜æ›´
        if [ -f outdated.json ]; then
          cat outdated.json | jq -r 'to_entries[] | "- **\(.key)**: \(.value.current) â†’ \(.value.wanted) (latest: \(.value.latest))"' >> change-summary.md
        fi
        
        echo "" >> change-summary.md
        echo "### âœ… Validation Results:" >> change-summary.md
        echo "- Type Check: ${{ env.TYPE_CHECK_FAILED != 'true' && 'âœ… Passed' || 'âŒ Failed' }}" >> change-summary.md
        echo "- Build: ${{ env.BUILD_FAILED != 'true' && 'âœ… Passed' || 'âŒ Failed' }}" >> change-summary.md
        echo "- Tests: ${{ env.TEST_FAILED != 'true' && 'âœ… Passed' || 'âš ï¸ Failed/Skipped' }}" >> change-summary.md
        echo "- Security: ${{ env.SECURITY_AUDIT_FAILED != 'true' && 'âœ… Clean' || 'âš ï¸ Issues Found' }}" >> change-summary.md
        
    - name: ðŸ“ Create Pull Request
      if: env.NO_CHANGES == 'false' && (env.VALIDATION_PASSED == 'true' || env.FORCE_UPDATE == 'true')
      uses: peter-evans/create-pull-request@v5
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: 'ðŸ”„ chore(deps): ${{ env.UPDATE_TYPE }} dependency updates'
        title: 'ðŸ”„ [${{ env.UPDATE_TYPE }}] Automated dependency updates - $(date +%Y-%m-%d)'
        body-path: change-summary.md
        branch: automated-dependency-updates-${{ github.run_number }}
        delete-branch: true
        labels: |
          dependencies
          automated
          ${{ env.UPDATE_TYPE }}
          ${{ needs.analyze-dependencies.outputs.security_updates != '0' && 'security' || '' }}
          ${{ env.VALIDATION_PASSED == 'true' && 'validated' || 'needs-review' }}
        assignees: ${{ github.actor }}
        reviewers: |
          ${{ github.actor }}
        draft: ${{ env.VALIDATION_PASSED != 'true' }}
        
    - name: ðŸš¨ Handle validation failures
      if: env.NO_CHANGES == 'false' && env.VALIDATION_PASSED != 'true' && env.FORCE_UPDATE != 'true'
      uses: actions/github-script@v7
      with:
        script: |
          const title = `ðŸš¨ Dependency Update Validation Failed - ${{ env.UPDATE_TYPE }}`;
          const body = `## ðŸš¨ Dependency Update Validation Issues
          
          **Update Type**: ${{ env.UPDATE_TYPE }}
          **Date**: ${new Date().toISOString()}
          **Summary**: ${{ needs.analyze-dependencies.outputs.update_summary }}
          
          ### âŒ Validation Failures:
          ${{ env.TYPE_CHECK_FAILED == 'true' && '- Type checking failed\n' || '' }}${{ env.BUILD_FAILED == 'true' && '- Build failed\n' || '' }}${{ env.TEST_FAILED == 'true' && '- Tests failed\n' || '' }}${{ env.SECURITY_AUDIT_FAILED == 'true' && '- Security issues found\n' || '' }}
          
          ### ðŸ”§ Manual Action Required:
          1. Review the validation failures above
          2. Check if the failures are related to the dependency updates
          3. Consider updating manually or fixing compatibility issues
          4. Re-run the workflow with \`force_update: true\` if the failures are acceptable
          
          ### ðŸ“‹ Next Steps:
          - Review detailed logs in the workflow run
          - Update dependencies manually if needed
          - Fix any breaking changes introduced by updates
          - Close this issue once resolved
          
          ---
          
          This issue was automatically created by the dependency update workflow.
          Run ID: ${{ github.run_id }}
          `;
          
          await github.rest.issues.create({
            owner: context.repo.owner,
            repo: context.repo.repo,
            title: title,
            body: body,
            labels: ['dependencies', 'validation-failed', '${{ env.UPDATE_TYPE }}']
          });

    - name: ðŸ“¤ Upload artifacts
      if: env.NO_CHANGES == 'false'
      uses: actions/upload-artifact@v4
      with:
        name: dependency-update-results
        path: |
          change-summary.md
          *.log
          audit-post.json
          package.json.backup
          package-lock.json.backup
        retention-days: 30

  # å¹²è¿è¡Œæ¨¡å¼çš„æ±‡æ€»
  dry-run-summary:
    name: ðŸ“Š Dry Run Summary  
    runs-on: ubuntu-latest
    needs: analyze-dependencies
    if: env.DRY_RUN == 'true'
    
    steps:
    - name: ðŸ“Š Generate dry run report
      run: |
        echo "## ðŸ” Dependency Update Dry Run Report" >> $GITHUB_STEP_SUMMARY
        echo "**Analysis Date**: $(date --iso-8601)" >> $GITHUB_STEP_SUMMARY
        echo "**Update Type**: ${{ env.UPDATE_TYPE }}" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        if [ "${{ needs.analyze-dependencies.outputs.has_updates }}" = "true" ]; then
          echo "### ðŸ“¦ Updates Available:" >> $GITHUB_STEP_SUMMARY
          echo "${{ needs.analyze-dependencies.outputs.update_summary }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ "${{ needs.analyze-dependencies.outputs.security_updates }}" != "0" ]; then
            echo "### âš ï¸ Security Updates: ${{ needs.analyze-dependencies.outputs.security_updates }}" >> $GITHUB_STEP_SUMMARY
            echo "Security vulnerabilities can be addressed with dependency updates." >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          fi
          
          if [ "${{ needs.analyze-dependencies.outputs.major_updates }}" != "0" ]; then
            echo "### ðŸš¨ Major Updates: ${{ needs.analyze-dependencies.outputs.major_updates }}" >> $GITHUB_STEP_SUMMARY
            echo "Major version updates require careful review for breaking changes." >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "### ðŸš€ To apply these updates:" >> $GITHUB_STEP_SUMMARY
          echo "1. Re-run this workflow with \`dry_run: false\`" >> $GITHUB_STEP_SUMMARY
          echo "2. Or run manually: \`npm update\` for minor updates" >> $GITHUB_STEP_SUMMARY
          echo "3. For major updates: \`npx npm-check-updates -u && npm install\`" >> $GITHUB_STEP_SUMMARY
        else
          echo "### âœ… No Updates Available" >> $GITHUB_STEP_SUMMARY
          echo "All dependencies are up to date." >> $GITHUB_STEP_SUMMARY
        fi

  # æœ€ç»ˆæ€»ç»“
  update-summary:
    name: ðŸ“‹ Update Summary
    runs-on: ubuntu-latest
    needs: [analyze-dependencies, update-dependencies]
    if: always()
    
    steps:
    - name: ðŸ“Š Generate final summary
      run: |
        echo "## ðŸ”„ Dependency Update Workflow Summary" >> $GITHUB_STEP_SUMMARY
        echo "**Workflow**: ${{ github.workflow }}" >> $GITHUB_STEP_SUMMARY
        echo "**Trigger**: ${{ github.event_name }}" >> $GITHUB_STEP_SUMMARY
        echo "**Update Type**: ${{ env.UPDATE_TYPE }}" >> $GITHUB_STEP_SUMMARY
        echo "**Dry Run**: ${{ env.DRY_RUN }}" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        echo "### ðŸ“Š Results:" >> $GITHUB_STEP_SUMMARY
        echo "| Stage | Status | Details |" >> $GITHUB_STEP_SUMMARY
        echo "|-------|--------|---------|" >> $GITHUB_STEP_SUMMARY
        echo "| Analysis | ${{ needs.analyze-dependencies.result }} | ${{ needs.analyze-dependencies.outputs.update_summary || 'No updates found' }} |" >> $GITHUB_STEP_SUMMARY
        echo "| Updates | ${{ needs.update-dependencies.result || 'skipped' }} | ${{ needs.update-dependencies.result == 'success' && 'Completed successfully' || needs.update-dependencies.result == 'failure' && 'Failed - check logs' || 'Skipped' }} |" >> $GITHUB_STEP_SUMMARY
        
        if [ "${{ needs.analyze-dependencies.outputs.security_updates }}" != "0" ]; then
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ”’ Security Information:" >> $GITHUB_STEP_SUMMARY
          echo "- **Security Updates Available**: ${{ needs.analyze-dependencies.outputs.security_updates }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Recommendation**: Review and apply security updates promptly" >> $GITHUB_STEP_SUMMARY
        fi
        
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ“… Next Steps:" >> $GITHUB_STEP_SUMMARY
        if [ "${{ env.DRY_RUN }}" = "true" ]; then
          echo "- This was a dry run - no changes were made" >> $GITHUB_STEP_SUMMARY
          echo "- Re-run with \`dry_run: false\` to apply updates" >> $GITHUB_STEP_SUMMARY
        elif [ "${{ needs.update-dependencies.result }}" = "success" ]; then
          echo "- Review any created pull requests" >> $GITHUB_STEP_SUMMARY
          echo "- Test the updated dependencies thoroughly" >> $GITHUB_STEP_SUMMARY
          echo "- Merge PR after validation" >> $GITHUB_STEP_SUMMARY
        elif [ "${{ needs.analyze-dependencies.outputs.has_updates }}" = "true" ]; then
          echo "- Check workflow logs for update issues" >> $GITHUB_STEP_SUMMARY
          echo "- Consider manual dependency updates" >> $GITHUB_STEP_SUMMARY
          echo "- Review any validation failures" >> $GITHUB_STEP_SUMMARY
        else
          echo "- No action required - dependencies are up to date" >> $GITHUB_STEP_SUMMARY
        fi
        
        echo "- **Next scheduled run**: Next Monday at 08:00 UTC" >> $GITHUB_STEP_SUMMARY
