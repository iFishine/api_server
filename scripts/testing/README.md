# ğŸ§ª Vitest æµ‹è¯•è„šæœ¬é›†åˆ

è¿™ä¸ªæ–‡ä»¶å¤¹åŒ…å«äº†ç”¨äºåŠ ç­æ—¶é•¿ç»Ÿè®¡ç³»ç»Ÿçš„å„ç§æµ‹è¯•è„šæœ¬ã€‚æ‰€æœ‰è„šæœ¬éƒ½ä½¿ç”¨ Vitest æµ‹è¯•æ¡†æ¶ã€‚

## ğŸ“ è„šæœ¬åˆ—è¡¨

| è„šæœ¬åç§° | åŠŸèƒ½æè¿° | ä½¿ç”¨åœºæ™¯ |
|---------|---------|---------|
| `test-menu.sh` | ğŸ“‹ **ä¸»èœå•è„šæœ¬** - äº¤äº’å¼é€‰æ‹©æµ‹è¯•æ“ä½œ | ğŸŒŸ æ¨èé¦–æ¬¡ä½¿ç”¨ |
| `quick-test-overtime.sh` | ğŸš€ å¿«é€Ÿè¿è¡Œæ‰€æœ‰æµ‹è¯•å¹¶æ˜¾ç¤ºè¦†ç›–ç‡ | æ—¥å¸¸å¼€å‘éªŒè¯ |
| `test-watch.sh` | ğŸ‘€ è§‚å¯Ÿæ¨¡å¼ - æ–‡ä»¶å˜åŒ–æ—¶è‡ªåŠ¨é‡æ–°è¿è¡Œæµ‹è¯• | å¼€å‘è¿‡ç¨‹ä¸­æŒç»­æµ‹è¯• |
| `test-ui.sh` | ğŸ¨ å¯åŠ¨å¯è§†åŒ–æµ‹è¯•ç•Œé¢ | æŸ¥çœ‹è¯¦ç»†æµ‹è¯•ç»“æœ |
| `test-coverage-detailed.sh` | ğŸ“Š ç”Ÿæˆè¯¦ç»†çš„HTMLè¦†ç›–ç‡æŠ¥å‘Š | ä»£ç è´¨é‡åˆ†æ |
| `test-performance.sh` | âš¡ æ€§èƒ½åŸºå‡†æµ‹è¯• - æµ‹é‡æ‰§è¡Œæ—¶é—´ | æ€§èƒ½ä¼˜åŒ–åˆ†æ |
| `test-cleanup.sh` | ğŸ§¹ æ¸…ç†æµ‹è¯•ç¼“å­˜å’Œä¸´æ—¶æ–‡ä»¶ | ç¯å¢ƒç»´æŠ¤ |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨äº¤äº’å¼èœå•ï¼ˆæ¨èï¼‰
```bash
npm run test:menu
```

### æ–¹æ³•äºŒï¼šç›´æ¥è¿è¡Œç‰¹å®šæµ‹è¯•
```bash
# å¿«é€Ÿæµ‹è¯•ï¼ˆæœ€å¸¸ç”¨ï¼‰
npm run test:overtime

# è§‚å¯Ÿæ¨¡å¼
npm run test:watch

# å¯è§†åŒ–ç•Œé¢
npm run test:ui

# è¯¦ç»†è¦†ç›–ç‡
npm run test:coverage

# æ€§èƒ½æµ‹è¯•
npm run test:performance

# æ¸…ç†ç¯å¢ƒ
npm run test:cleanup
```

## ğŸ“‹ è¯¦ç»†è¯´æ˜

### ğŸŒŸ ä¸»èœå•è„šæœ¬ (`test-menu.sh`)
- æä¾›äº¤äº’å¼èœå•ç•Œé¢
- åŒ…å«æ‰€æœ‰æµ‹è¯•åŠŸèƒ½çš„å…¥å£
- å¸¦æœ‰å¸®åŠ©ä¿¡æ¯å’Œä½¿ç”¨æŒ‡å¯¼
- é€‚åˆæ–°ç”¨æˆ·å’Œå¶å°”ä½¿ç”¨è€…

### ğŸš€ å¿«é€Ÿæµ‹è¯•è„šæœ¬ (`quick-test-overtime.sh`)
- è¿è¡Œæ‰€æœ‰22ä¸ªæµ‹è¯•ç”¨ä¾‹
- æ˜¾ç¤ºåŸºæœ¬è¦†ç›–ç‡ä¿¡æ¯
- å½©è‰²è¾“å‡ºï¼Œæ˜“äºé˜…è¯»
- æ‰§è¡Œæ—¶é—´é€šå¸¸ < 1ç§’

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
ğŸš€ å¼€å§‹è¿è¡ŒåŠ ç­æ—¶é•¿ç»Ÿè®¡æµ‹è¯•...
==================================
âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
ğŸ“Š è¦†ç›–ç‡è¾¾åˆ°90.2%
ğŸ‰ æµ‹è¯•å®Œæˆï¼
```

### ğŸ‘€ è§‚å¯Ÿæ¨¡å¼è„šæœ¬ (`test-watch.sh`)
- ç›‘å¬ä»¥ä¸‹æ–‡ä»¶å˜åŒ–ï¼š
  - `server/services/overtimeService.ts`
  - `server/services/*.test.ts`
  - `server/services/*.integration.test.ts`
- æ–‡ä»¶å˜åŒ–æ—¶è‡ªåŠ¨é‡æ–°è¿è¡Œæµ‹è¯•
- é€‚åˆå¼€å‘è¿‡ç¨‹ä¸­çš„æŒç»­æµ‹è¯•

### ğŸ¨ å¯è§†åŒ–ç•Œé¢è„šæœ¬ (`test-ui.sh`)
- å¯åŠ¨Webç•Œé¢ï¼š`http://localhost:51204/__vitest__/`
- åŠŸèƒ½åŒ…æ‹¬ï¼š
  - å®æ—¶æµ‹è¯•ç»“æœæŸ¥çœ‹
  - äº¤äº’å¼æµ‹è¯•è¿è¡Œ
  - ä»£ç è¦†ç›–ç‡å¯è§†åŒ–
  - æµ‹è¯•æ–‡ä»¶æµè§ˆ

### ğŸ“Š è¯¦ç»†è¦†ç›–ç‡è„šæœ¬ (`test-coverage-detailed.sh`)
- ç”Ÿæˆå¤šç§æ ¼å¼çš„è¦†ç›–ç‡æŠ¥å‘Šï¼š
  - ç»ˆç«¯æ–‡æœ¬è¾“å‡º
  - JSONæ ¼å¼ï¼š`coverage/coverage-final.json`
  - HTMLå¯è§†åŒ–ï¼š`coverage/index.html`
- è‡ªåŠ¨æ˜¾ç¤ºHTMLæŠ¥å‘Šçš„è®¿é—®è·¯å¾„

### âš¡ æ€§èƒ½æµ‹è¯•è„šæœ¬ (`test-performance.sh`)
- æµ‹é‡æµ‹è¯•æ‰§è¡Œæ—¶é—´
- è®¡ç®—å¹³å‡æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹çš„æ—¶é—´
- æä¾›æ€§èƒ½è¯„çº§ï¼š
  - ğŸš€ ä¼˜ç§€ï¼š< 1ç§’
  - âš¡ è‰¯å¥½ï¼š< 3ç§’
  - ğŸŒ éœ€è¦ä¼˜åŒ–ï¼š> 3ç§’
- åŒ…å«æ€§èƒ½ä¼˜åŒ–å»ºè®®

### ğŸ§¹ æ¸…ç†è„šæœ¬ (`test-cleanup.sh`)
- åˆ é™¤æµ‹è¯•ç›¸å…³çš„ä¸´æ—¶æ–‡ä»¶ï¼š
  - `coverage/` è¦†ç›–ç‡æŠ¥å‘Šç›®å½•
  - `node_modules/.vitest/` Vitestç¼“å­˜
  - `.nyc_output/` NYCè¾“å‡º
  - `test.log` æµ‹è¯•æ—¥å¿—
- é€‚åˆåœ¨æµ‹è¯•ç¯å¢ƒå‡ºç°é—®é¢˜æ—¶ä½¿ç”¨

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

æ‰€æœ‰è„šæœ¬éƒ½å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œè‡ªå®šä¹‰ï¼š

1. **ä¿®æ”¹é¢œè‰²ä¸»é¢˜**ï¼šç¼–è¾‘è„šæœ¬é¡¶éƒ¨çš„é¢œè‰²å®šä¹‰
2. **è°ƒæ•´æ€§èƒ½é˜ˆå€¼**ï¼šä¿®æ”¹ `test-performance.sh` ä¸­çš„æ—¶é—´åˆ¤æ–­æ¡ä»¶
3. **æ·»åŠ æ–°çš„æ¸…ç†é¡¹**ï¼šåœ¨ `test-cleanup.sh` ä¸­æ·»åŠ æ›´å¤šæ¸…ç†é€»è¾‘

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **è„šæœ¬æ²¡æœ‰æ‰§è¡Œæƒé™**
   ```bash
   chmod +x scripts/testing/*.sh
   ```

2. **æ‰¾ä¸åˆ°npmå‘½ä»¤**
   - ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
   - æ£€æŸ¥Node.jså’Œnpmæ˜¯å¦æ­£ç¡®å®‰è£…

3. **æµ‹è¯•å¤±è´¥**
   - è¿è¡Œ `npm run test:cleanup` æ¸…ç†ç¯å¢ƒ
   - æ£€æŸ¥ä¾èµ–æ˜¯å¦å®Œæ•´å®‰è£…ï¼š`npm install`

4. **ç«¯å£å ç”¨ï¼ˆUIæ¨¡å¼ï¼‰**
   - æ£€æŸ¥ç«¯å£51204æ˜¯å¦è¢«å ç”¨
   - æ€æ­»ç›¸å…³è¿›ç¨‹æˆ–ä½¿ç”¨å…¶ä»–ç«¯å£

### è°ƒè¯•æ¨¡å¼

åœ¨è„šæœ¬ä¸­æ·»åŠ  `set -x` å¯ä»¥å¯ç”¨è°ƒè¯•æ¨¡å¼ï¼Œæ˜¾ç¤ºæ¯ä¸ªå‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹ï¼š

```bash
#!/bin/bash
set -x  # å¯ç”¨è°ƒè¯•æ¨¡å¼
# ... è„šæœ¬å†…å®¹
```

## ğŸš€ é›†æˆåˆ°CI/CD

è¿™äº›è„šæœ¬ä¹Ÿå¯ä»¥é›†æˆåˆ°æŒç»­é›†æˆæµç¨‹ä¸­ï¼š

```yaml
# GitHub Actions ç¤ºä¾‹
- name: Run Quick Tests
  run: ./scripts/testing/quick-test-overtime.sh

- name: Generate Coverage Report
  run: ./scripts/testing/test-coverage-detailed.sh

- name: Performance Benchmark
  run: ./scripts/testing/test-performance.sh
```

## ğŸ“Š æµ‹è¯•ç»Ÿè®¡

å½“å‰æµ‹è¯•è¦†ç›–æƒ…å†µï¼š
- **æµ‹è¯•ç”¨ä¾‹æ€»æ•°**: 22ä¸ª
- **å•å…ƒæµ‹è¯•**: 19ä¸ª
- **é›†æˆæµ‹è¯•**: 3ä¸ª
- **ä»£ç è¦†ç›–ç‡**: 90.2%
- **å¹³å‡æ‰§è¡Œæ—¶é—´**: < 300ms

---

ğŸ’¡ **æç¤º**: å»ºè®®æ–°ç”¨æˆ·ä» `npm run test:menu` å¼€å§‹ï¼Œç†Ÿæ‚‰å„ç§æµ‹è¯•åŠŸèƒ½åå†ç›´æ¥ä½¿ç”¨å…·ä½“çš„è„šæœ¬å‘½ä»¤ã€‚
